# SỬA Ở ĐÂY: Sử dụng Node.js phiên bản 20 để tương thích với Colyseus
FROM node:20-alpine

# Đặt thư mục làm việc bên trong container
WORKDIR /usr/src/app

# Sao chép package.json và package-lock.json trước
COPY package*.json ./

# Cài đặt các dependencies
# Lệnh này sẽ cài cả dependencies và devDependencies nếu NODE_ENV không được set
# Hoặc nó sẽ cài typescript vì nó đã nằm trong dependencies
RUN npm install

# Sao chép toàn bộ mã nguồn còn lại
COPY . .

# Biên dịch mã TypeScript thành JavaScript
RUN npm run build

# Lệnh để chạy ứng dụng sau khi build xong
CMD ["npm", "start"]